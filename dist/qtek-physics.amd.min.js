define("qtek/physics/qtek-physics.amd",[],function(){console.log("Loaded qtek physics module"),console.log("Author : https://github.com/pissang/")}),define("qtek/core/mixin/derive",["require"],function(){function a(a,d,e){"object"==typeof d&&(e=d,d=null);var f,g=this;if(!(a instanceof Function)){f=[];for(var h in a)a.hasOwnProperty(h)&&f.push(h)}var i=function(d){if(g.call(this),a instanceof Function?b(this,a.call(this)):c(this,a,f),d&&b(this,d),this.constructor===i)for(var e=i.__initializer__,h=0;h<e.length;h++)e[h].call(this)};i.__super__=g,i.__initializer__=g.__initializer__?g.__initializer__.slice():[],d&&i.__initializer__.push(d);var j=function(){};return j.prototype=g.prototype,i.prototype=new j,i.prototype.constructor=i,b(i.prototype,e),i.derive=g.derive,i}function b(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function c(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];a[e]=b[e]}}return{derive:a}}),define("qtek/core/mixin/notifier",[],function(){function a(a,b){this.action=a,this.context=b}return{trigger:function(a){if(this.hasOwnProperty("__handlers__")&&this.__handlers__.hasOwnProperty(a)){var b=this.__handlers__[a],c=b.length,d=-1,e=arguments;switch(e.length){case 1:for(;++d<c;)b[d].action.call(b[d].context);return;case 2:for(;++d<c;)b[d].action.call(b[d].context,e[1]);return;case 3:for(;++d<c;)b[d].action.call(b[d].context,e[1],e[2]);return;case 4:for(;++d<c;)b[d].action.call(b[d].context,e[1],e[2],e[3]);return;case 5:for(;++d<c;)b[d].action.call(b[d].context,e[1],e[2],e[3],e[4]);return;default:for(;++d<c;)b[d].action.apply(b[d].context,Array.prototype.slice.call(e,1));return}}},on:function(b,c,d){if(b&&c){var e=this.__handlers__||(this.__handlers__={});if(e[b]){if(this.has(b,c))return}else e[b]=[];var f=new a(c,d||this);return e[b].push(f),f}},once:function(a,b,c){function d(){e.off(a,d),b.apply(this,arguments)}if(a&&b){var e=this;return this.on(a,d,c)}},before:function(a,b,c){return a&&b?(a="before"+a,this.on(a,b,c)):void 0},after:function(a,b,c){return a&&b?(a="after"+a,this.on(a,b,c)):void 0},success:function(a,b){return this.once("success",a,b)},error:function(){return this.once("error",action,context)},off:function(a,b){var c=this.__handlers__||(this.__handlers__={});if(!b)return void(c[a]=[]);if(c[a]){for(var d=c[a],e=[],f=0;f<d.length;f++)b&&d[f].action!==b&&e.push(d[f]);c[a]=e}},has:function(a,b){var c=this.__handlers__;if(!c||!c[a])return!1;for(var d=c[a],e=0;e<d.length;e++)if(d[e].action===b)return!0}}}),define("qtek/core/util",["require"],function(){var a=0,b={genGUID:function(){return++a},relative2absolute:function(a,b){if(!b||a.match(/^\//))return a;for(var c=a.split("/"),d=b.split("/"),e=c[0];"."===e||".."===e;)".."===e&&d.pop(),c.shift(),e=c[0];return d.join("/")+"/"+c.join("/")},extend:function(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},defaults:function(a,b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])},extendWithPropList:function(a,b,c){if(b)for(var d=0;d<c.length;d++){var e=c[d];a[e]=b[e]}return a},defaultsWithPropList:function(a,b,c){if(b)for(var d=0;d<c.length;d++){var e=c[d];void 0===a[e]&&(a[e]=b[e])}return a},each:function(a,b,c){if(a&&b)if(a.forEach)a.forEach(b,c);else if(a.length===+a.length)for(var d=0,e=a.length;e>d;d++)b.call(c,a[d],d,a);else for(var f in a)a.hasOwnProperty(f)&&b.call(c,a[f],f,a)},isObject:function(a){return a===Object(a)},isArray:function(a){return a instanceof Array},isArrayLike:function(a){return a?a.length===+a.length:!1},clone:function(a){if(b.isObject(a)){if(b.isArray(a))return a.slice();if(b.isArrayLike(a)){for(var c=new a.constructor(a.length),d=0;d<a.length;d++)c[d]=a[d];return c}return b.extend({},a)}return a}};return b}),define("qtek/core/Base",["require","./mixin/derive","./mixin/notifier","./util"],function(a){var b=a("./mixin/derive"),c=a("./mixin/notifier"),d=a("./util"),e=function(){this.__GUID__=d.genGUID()};return d.extend(e,b),d.extend(e.prototype,c),e}),define("qtek/physics/Shape",["require","qtek/core/Base"],function(a){var b=a("qtek/core/Base"),c=b.derive({},{dirty:function(){this._dirty=!0}});return c}),define("qtek/math/Vector3",["require","glmatrix"],function(a){var b=a("glmatrix"),c=b.vec3,d=function(a,b,d){a=a||0,b=b||0,d=d||0,this._array=c.fromValues(a,b,d),this._dirty=!0};return d.prototype={constructor:d,get x(){return this._array[0]},set x(a){this._array[0]=a,this._dirty=!0},get y(){return this._array[1]},set y(a){this._array[1]=a,this._dirty=!0},get z(){return this._array[2]},set z(a){this._array[2]=a,this._dirty=!0},add:function(a){return c.add(this._array,this._array,a._array),this._dirty=!0,this},set:function(a,b,c){return this._array[0]=a,this._array[1]=b,this._array[2]=c,this._dirty=!0,this},setArray:function(a){return this._array[0]=a[0],this._array[1]=a[1],this._array[2]=a[2],this._dirty=!0,this},clone:function(){return new d(this.x,this.y,this.z)},copy:function(a){return c.copy(this._array,a._array),this._dirty=!0,this},cross:function(a,b){return c.cross(a._array,this._array,b._array),this},dist:function(a){return c.dist(this._array,a._array)},distance:function(a){return c.distance(this._array,a._array)},div:function(a){return c.div(this._array,this._array,a._array),this._dirty=!0,this},divide:function(a){return c.divide(this._array,this._array,a._array),this._dirty=!0,this},dot:function(a){return c.dot(this._array,a._array)},len:function(){return c.len(this._array)},length:function(){return c.length(this._array)},lerp:function(a,b,d){return c.lerp(this._array,a._array,b._array,d),this._dirty=!0,this},min:function(a){return vec2.min(this._array,this._array,a._array),this._dirty=!0,this},max:function(a){return vec2.max(this._array,this._array,a._array),this._dirty=!0,this},mul:function(a){return c.mul(this._array,this._array,a._array),this._dirty=!0,this},multiply:function(a){return c.multiply(this._array,this._array,a._array),this._dirty=!0,this},negate:function(){return c.negate(this._array,this._array),this._dirty=!0,this},normalize:function(){return c.normalize(this._array,this._array),this._dirty=!0,this},random:function(a){return c.random(this._array,a),this._dirty=!0,this},scale:function(a){return c.scale(this._array,this._array,a),this._dirty=!0,this},scaleAndAdd:function(a,b){return c.scaleAndAdd(this._array,this._array,a._array,b),this._dirty=!0,this},sqrDist:function(a){return c.sqrDist(this._array,a._array)},squaredDistance:function(a){return c.squaredDistance(this._array,a._array)},sqrLen:function(){return c.sqrLen(this._array)},squaredLength:function(){return c.squaredLength(this._array)},sub:function(a){return c.sub(this._array,this._array,a._array),this._dirty=!0,this},subtract:function(a){return c.subtract(this._array,this._array,a._array),this._dirty=!0,this},transformMat3:function(a){return c.transformMat3(this._array,this._array,a._array),this._dirty=!0,this},transformMat4:function(a){return c.transformMat4(this._array,this._array,a._array),this._dirty=!0,this},transformQuat:function(a){return c.transformQuat(this._array,this._array,a._array),this._dirty=!0,this},setEulerFromQuaternion:function(){},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"}},d.POSITIVE_X=new d(1,0,0),d.NEGATIVE_X=new d(-1,0,0),d.POSITIVE_Y=new d(0,1,0),d.NEGATIVE_Y=new d(0,-1,0),d.POSITIVE_Z=new d(0,0,1),d.NEGATIVE_Z=new d(0,0,-1),d.UP=new d(0,1,0),d.ZERO=new d(0,0,0),d}),define("qtek/physics/BoxShape",["require","./Shape","qtek/math/Vector3"],function(a){var b=a("./Shape"),c=a("qtek/math/Vector3"),d=b.derive({halfExtents:null},function(){this.halfExtents||(this.halfExtents=new c(1,1,1))});return Object.defineProperty(d.prototype,"width",{get:function(){return 2*this.halfExtents._array[0]},set:function(a){this.halfExtents._array[0]=a/2,this.halfExtents._dirty=!0}}),Object.defineProperty(d.prototype,"height",{get:function(){return 2*this.halfExtents._array[1]},set:function(a){this.halfExtents._array[1]=a/2,this.halfExtents._dirty=!0}}),Object.defineProperty(d.prototype,"depth",{get:function(){return 2*this.halfExtents._array[2]},set:function(a){this.halfExtents._array[2]=a/2,this.halfExtents._dirty=!0}}),d}),define("qtek/physics/Buffer",["require"],function(){var a=function(){this._data=[],this._offset=0};return a.prototype.set=function(a,b){this._data[a]=b},a.prototype.setOffset=function(a){this._offset=a},a.prototype.toFloat32Array=function(){return this._data.length=this._offset,new Float32Array(this._data)},a.prototype.reset=function(){this._data=[],this._offset=0},a.prototype.packScalar=function(a){this._data[this._offset++]=a},a.prototype.packVector2=function(a){this._data[this._offset++]=a._array[0],this._data[this._offset++]=a._array[1]},a.prototype.packVector3=function(a){this._data[this._offset++]=a._array[0],this._data[this._offset++]=a._array[1],this._data[this._offset++]=a._array[2]},a.prototype.packVector4=function(a){this._data[this._offset++]=a._array[0],this._data[this._offset++]=a._array[1],this._data[this._offset++]=a._array[2],this._data[this._offset++]=a._array[3]},a.prototype.packArray=function(a){for(var b=0;b<a.length;b++)this._data[this._offset++]=a[b]},a.prototype.packValues=function(){this.packArray(arguments)},a}),define("qtek/physics/BvhTriangleMeshShape",["require","./Shape"],function(a){var b=a("./Shape"),c=b.derive({geometry:null});return c}),define("qtek/physics/CapsuleShape",["require","./Shape","qtek/math/Vector3"],function(a){var b=a("./Shape"),c=(a("qtek/math/Vector3"),b.derive({_radius:1,_height:1,_dirty:!0}));return Object.defineProperty(c.prototype,"radius",{get:function(){return this._radius},set:function(a){this._radius=a,this._dirty=!0}}),Object.defineProperty(c.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a,this._dirty=!0}}),Object.defineProperty(c.prototype,"halfHeight",{get:function(){return this._height/2},set:function(a){this._height=2*a,this._dirty=!0}}),c}),define("qtek/physics/Collider",["require","qtek/core/Base"],function(a){var b=a("qtek/core/Base"),c=b.derive({collisionObject:null,sceneNode:null,physicsMaterial:null,isKinematic:!1,isStatic:!1,isGhostObject:!1,_dirty:!0,_collisionHasCallback:!1},{on:function(a,c,d){b.prototype.on.call(this,a,c,d),this._collisionHasCallback=!0,this._dirty=!0},off:function(a,c){b.prototype.off.call(this,a,c)},hasCollisionCallback:function(){return this._collisionHasCallback}});return c.events=["collision"],c}),define("qtek/physics/ConeShape",["require","./Shape","qtek/math/Vector3"],function(a){var b=a("./Shape"),c=(a("qtek/math/Vector3"),b.derive({_radius:1,_height:1,_dirty:!0}));return Object.defineProperty(c.prototype,"radius",{get:function(){return this._radius},set:function(a){this._radius=a,this._dirty=!0}}),Object.defineProperty(c.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a,this._dirty=!0}}),c}),define("qtek/physics/ContactPoint",["require","qtek/math/Vector3"],function(){var a=require("qtek/math/Vector3"),b=function(){this.thisPoint=new a,this.otherPoint=new a,this.otherCollider=null,this.thisCollider=null,this.normal=new a};return b}),define("qtek/physics/ConvexHullShape",["require","./Shape"],function(a){var b=a("./Shape"),c=b.derive({geometry:null});return c}),define("qtek/physics/ConvexTriangleMeshShape",["require","./Shape"],function(a){var b=a("./Shape"),c=b.derive({geometry:null});return c}),define("qtek/physics/CylinderShape",["require","./Shape","qtek/math/Vector3"],function(a){var b=a("./Shape"),c=a("qtek/math/Vector3"),d=b.derive({halfExtents:null,_upAxis:1,_dirty:!0,_radiusIdx:0,_heightIdx:1},function(){this.halfExtents||(this.halfExtents=new c(1,1,1))});return Object.defineProperty(d.prototype,"radius",{get:function(){return this.halfExtents._array[this._radiusIdx]},set:function(a){this.halfExtents._array[this._radiusIdx]=a,this.halfExtents._dirty=!0}}),Object.defineProperty(d.prototype,"height",{get:function(){return 2*this.halfExtents._array[this._heightIdx]},set:function(a){this.halfExtents._array[this._heightIdx]=a/2,this.halfExtents._dirty=!0}}),Object.defineProperty(d.prototype,"upAxis",{set:function(a){switch(a){case 0:this._radiusIdx=1,this._heightIdx=0;break;case 2:this._radiusIdx=0,this._heightIdx=2;break;default:this._radiusIdx=0,this._heightIdx=1}this._upAxis=a,this._dirty=!0},get:function(){return this._upAxis}}),d}),define("qtek/physics/AmmoEngineConfig.js",[],function(){return"'use strict';\n\n// Data format\n// Command are transferred in batches\n// ncmd - [cmd chunk][cmd chunk]...\n// Add rigid body :\n//      ------header------ \n//      cmdtype(1)\n//      idx(1)\n//      32 bit mask(1)\n//          But because it is stored in Float, so it can only use at most 24 bit (TODO)\n//      -------body-------\n//      collision flag(1)\n//      ...\n//      collision shape guid(1)\n//      shape type(1)\n//      ...\n// Remove rigid body:\n//      cmdtype(1)\n//      idx(1)\n//      \n// Mod rigid body :\n//      ------header------\n//      cmdtype(1)\n//      idx(1)\n//      32 bit mask(1)\n//      -------body-------\n//      ...\n//      \n// Step\n//      cmdtype(1)\n//      timeStep(1)\n//      maxSubSteps(1)\n//      fixedTimeStep(1)\nthis.CMD_ADD_COLLIDER = 0;\nthis.CMD_REMOVE_COLLIDER = 1;\nthis.CMD_MOD_COLLIDER = 2;\nthis.CMD_SYNC_MOTION_STATE = 3;\nthis.CMD_STEP_TIME = 4;\nthis.CMD_COLLISION_CALLBACK = 5;\n\nthis.CMD_SYNC_INERTIA_TENSOR = 6;\n\n// Message of step\nthis.CMD_STEP = 10;\n\n// Shape types\nthis.SHAPE_BOX = 0;\nthis.SHAPE_SPHERE = 1;\nthis.SHAPE_CYLINDER = 2;\nthis.SHAPE_CONE = 3;\nthis.SHAPE_CAPSULE = 4;\nthis.SHAPE_CONVEX_TRIANGLE_MESH = 5;\nthis.SHAPE_CONVEX_HULL = 6;\nthis.SHAPE_STATIC_PLANE = 7;\nthis.SHAPE_BVH_TRIANGLE_MESH = 8;\n\n// Rigid Body properties and bit mask\n// 1. Property name\n// 2. Property size\n// 3. Mod bit mask, to check if part of rigid body needs update\nthis.RIGID_BODY_PROPS = [\n    ['linearVelocity', 3, 0x1],\n    ['angularVelocity', 3, 0x2],\n    ['linearFactor', 3, 0x4],\n    ['angularFactor', 3, 0x8],\n    ['centerOfMass', 3, 0x10],\n    ['localInertia', 3, 0x20],\n    ['massAndDamping', 3, 0x40],\n    ['totalForce', 3, 0x80],\n    ['totalTorque', 3, 0x100]\n];\n\nthis.RIGID_BODY_PROP_MOD_BIT = {};\nthis.RIGID_BODY_PROPS.forEach(function(item) {\n    this.RIGID_BODY_PROP_MOD_BIT[item[0]] = item[2];\n}, this);\n\nthis.SHAPE_MOD_BIT = 0x200;\nthis.MATERIAL_MOD_BIT = 0x400;\nthis.COLLISION_FLAG_MOD_BIT = 0x800;\n\nthis.MOTION_STATE_MOD_BIT = 0x1000;\n\nthis.MATERIAL_PROPS = [\n    ['friction', 1],\n    ['bounciness', 1],\n];\n\n// Collision Flags\nthis.COLLISION_FLAG_STATIC = 0x1;\nthis.COLLISION_FLAG_KINEMATIC = 0x2;\nthis.COLLISION_FLAG_GHOST_OBJECT = 0x4;\n\nthis.COLLISION_FLAG_HAS_CALLBACK = 0x200;\n\n// Collision Status\nthis.COLLISION_STATUS_ENTER = 1;\nthis.COLLISION_STATUS_STAY = 2;\nthis.COLLISION_STATUS_LEAVE = 3;\n"}),define("qtek/physics/SphereShape",["require","./Shape"],function(a){var b=a("./Shape"),c=b.derive({_radius:1,_dirty:!0});return Object.defineProperty(c.prototype,"radius",{get:function(){return this._radius},set:function(a){this._radius=a,this._dirty=!0}}),c}),define("qtek/math/Plane",["require","./Vector3","glmatrix"],function(a){var b=a("./Vector3"),c=a("glmatrix"),d=c.vec3,e=function(a,c){this.normal=a||new b,this.distance=c};return e.prototype={constructor:e,distanceToPoint:function(a){return d.dot(a._array,this.normal._array)-this.distance},normalize:function(){var a=1/d.len(this.normal._array);d.scale(this.normal._array,a),this.distance*=a}},e}),define("qtek/physics/StaticPlaneShape",["require","./Shape","qtek/math/Plane"],function(a){var b=a("./Shape"),c=a("qtek/math/Plane"),d=b.derive({_dirty:!1},function(){this.plane||(this.plane=new c,this.plane.normal.set(0,0,1),this.plane.distance=0)});return d}),define("qtek/physics/Engine",["require","qtek/core/Base","./AmmoEngineConfig.js","./BoxShape","./CapsuleShape","./ConeShape","./CylinderShape","./SphereShape","./StaticPlaneShape","./ConvexTriangleMeshShape","./BvhTriangleMeshShape","./ConvexHullShape","./Buffer","./ContactPoint","qtek/math/Vector3"],function(a){var b=a("qtek/core/Base"),c=a("./AmmoEngineConfig.js"),d=a("./BoxShape"),e=a("./CapsuleShape"),f=a("./ConeShape"),g=a("./CylinderShape"),h=a("./SphereShape"),i=a("./StaticPlaneShape"),j=a("./ConvexTriangleMeshShape"),k=a("./BvhTriangleMeshShape"),l=a("./ConvexHullShape"),m=a("./Buffer"),n=a("./ContactPoint"),o=(a("qtek/math/Vector3"),new Function(c)),p=new o,q=b.derive({workerUrl:"",maxSubSteps:3,fixedTimeStep:1/60,_stepTime:0,_isWorkerFree:!0},function(){this.init()},{init:function(){this._engineWorker=new Worker(this.workerUrl),this._colliders=[],this._empties=[],this._collidersToAdd=[],this._collidersToRemove=[],this._contacts=[],this._cmdBuffer=new m;var a=this;this._engineWorker.onmessage=function(b){for(var c=new Float32Array(b.data),d=c[0],e=1,f=0;d>f;f++){var g=c[e++];switch(g){case p.CMD_SYNC_MOTION_STATE:e=a._syncMotionState(c,e);break;case p.CMD_STEP_TIME:a._stepTime=c[e++];break;case p.CMD_COLLISION_CALLBACK:e=a._dispatchCollisionCallback(c,e);break;case p.CMD_SYNC_INERTIA_TENSOR:e=a._syncInertiaTensor(c,e)}}a._isWorkerFree=!0,a.trigger("afterstep")}},step:function(a){if(!this._isWorkerFree)return void(this._stepTime=a);var b=0;this._cmdBuffer.setOffset(0),this._cmdBuffer.packScalar(0),b+=this._doModCollider(),b+=this._doRemoveCollider(),b+=this._doAddCollider(),this._cmdBuffer.packValues(p.CMD_STEP,this._stepTime,this.maxSubSteps,this.fixedTimeStep),b++,this._cmdBuffer.set(0,b);var c=this._cmdBuffer.toFloat32Array();this._engineWorker.postMessage(c.buffer,[c.buffer]);for(var d=0;d<this._colliders.length;d++){var e=this._colliders[d];if(!(e.isStatic||e.isKinematic||e.isGhostObject)){var f=e.collisionObject;f.totalForce._array[0]=0,f.totalForce._array[1]=0,f.totalForce._array[2]=0,f.totalTorque._array[0]=0,f.totalTorque._array[1]=0,f.totalTorque._array[2]=0}}this._isWorkerFree=!1,this._stepTime=0},addCollider:function(a){this._collidersToAdd.push(a)},removeCollider:function(a){var b=this._colliders.indexOf(a);b>=0&&this._collidersToRemove.push(b)},_doAddCollider:function(){for(var a=0,b=0;b<this._collidersToAdd.length;b++){var c,d=this._collidersToAdd[b];this._empties.length>0?(c=this._empties.pop(),this._colliders[c]=d):(c=this._colliders.length,this._colliders.push(d)),this._cmdBuffer.packValues(p.CMD_ADD_COLLIDER,c);var e=this._cmdBuffer._offset++,f=this._packCollider(d,!0);this._cmdBuffer.set(e,f),a++}return this._collidersToAdd.length=0,a},_doRemoveCollider:function(){for(var a=0,b=0;b<this._collidersToRemove.length;b++){var c=this._collidersToRemove[b];this._colliders[c]=null,this._empties.push(c),this._cmdBuffer.packValues(p.CMD_REMOVE_COLLIDER,c),a++}return this._collidersToRemove.length=0,a},_doModCollider:function(){for(var a=0,b=0;b<this._colliders.length;b++){var c=this._colliders[b],d=this._cmdBuffer._offset;this._cmdBuffer._offset+=3;var e=this._packCollider(c);0!==e?(this._cmdBuffer.set(d,p.CMD_MOD_COLLIDER),this._cmdBuffer.set(d+1,b),this._cmdBuffer.set(d+2,e),a++):this._cmdBuffer._offset-=3}return a},_packCollider:function(a,b){var c=0;if(b||a._dirty){var d=0;a.isStatic&&(d|=p.COLLISION_FLAG_STATIC),a.isKinematic&&(d|=p.COLLISION_FLAG_KINEMATIC),a.isGhostObject&&(d|=p.COLLISION_FLAG_GHOST_OBJECT),a._collisionHasCallback&&(d|=p.COLLISION_FLAG_HAS_CALLBACK),this._cmdBuffer.packScalar(d),c|=p.COLLISION_FLAG_MOD_BIT,a._dirty=!1}(b||a.isKinematic)&&(this._cmdBuffer.packVector3(a.sceneNode.position),this._cmdBuffer.packVector4(a.sceneNode.rotation),c|=p.MOTION_STATE_MOD_BIT);var e=a.collisionObject;if(!a.isGhostObject)for(var f=0;f<p.RIGID_BODY_PROPS.length;f++){var g=p.RIGID_BODY_PROPS[f],h=g[0],i=e[h],j=g[1];void 0!==i&&null!==i&&(j>1?(i._dirty||b)&&(3===j?this._cmdBuffer.packVector3(i):4===j&&this._cmdBuffer.packVector4(i),c|=g[2],i._dirty=!1):console.warn("TODO"))}var k=this._packShape(e.shape,b);if(k&&(c|=p.SHAPE_MOD_BIT),!a.isGhostObject){var l=a.physicsMaterial;if(l._dirty||b){c|=p.MATERIAL_MOD_BIT;for(var f=0;f<p.MATERIAL_PROPS.length;f++){var g=p.MATERIAL_PROPS[f],h=g[0],i=l[h],j=g[1];1===j&&this._cmdBuffer.packScalar(i)}l._dirty=!1}}return c},_packShape:function(a,b){if(!(b||a.halfExtents&&a.halfExtents._dirty&&!a._dirty))return!1;if(this._cmdBuffer.packScalar(a.__GUID__),a instanceof d)this._cmdBuffer.packScalar(p.SHAPE_BOX),this._cmdBuffer.packVector3(a.halfExtents);else if(a instanceof h)this._cmdBuffer.packScalar(p.SHAPE_SPHERE),this._cmdBuffer.packScalar(a._radius);else if(a instanceof g)this._cmdBuffer.packScalar(p.SHAPE_CYLINDER),this._cmdBuffer.packVector3(a.halfExtents);else if(a instanceof f)this._cmdBuffer.packScalar(p.SHAPE_CONE),this._cmdBuffer.packScalar(a._radius),this._cmdBuffer.packScalar(a._height);else if(a instanceof e)this._cmdBuffer.packScalar(p.SHAPE_CAPSULE),this._cmdBuffer.packScalar(a._radius),this._cmdBuffer.packScalar(a._height);else if(a instanceof i)this._cmdBuffer.packScalar(p.SHAPE_STATIC_PLANE),this._cmdBuffer.packVector3(a.plane.normal),this._cmdBuffer.packScalar(a.plane.distance);else if(a instanceof j||a instanceof k){this._cmdBuffer.packScalar(a instanceof j?p.SHAPE_CONVEX_TRIANGLE_MESH:p.SHAPE_BVH_TRIANGLE_MESH);var c=a.geometry;if(this._cmdBuffer.packScalar(c.getFaceNumber()),this._cmdBuffer.packScalar(c.getVertexNumber()),c.isStatic())this._cmdBuffer.packArray(c.faces),this._cmdBuffer.packArray(c.attributes.position.value);else{for(var m=0;m<c.faces.length;m++)this._cmdBuffer.packArray(c.faces[m]);for(var m=0;m<c.attributes.position.value.length;m++)this._cmdBuffer.packArray(c.attributes.position.value[m])}}else if(a instanceof l){this._cmdBuffer.packScalar(p.SHAPE_CONVEX_HULL);var c=a.geometry;if(this._cmdBuffer.packScalar(c.getVertexNumber()),c.isStatic())this._cmdBuffer.packArray(c.attributes.position.value);else for(var m=0;m<c.attributes.position.value.length;m++)this._cmdBuffer.packArray(c.attributes.position.value[m])}return a.halfExtents&&(a.halfExtents._dirty=!1),a._dirty=!1,!0},_syncMotionState:function(a,b){for(var c=a[b++],d=0;c>d;d++){var e=a[b++],f=this._colliders[e],g=f.sceneNode;g&&(g.position.set(a[b++],a[b++],a[b++]),g.rotation.set(a[b++],a[b++],a[b++],a[b++]))}return b},_dispatchCollisionCallback:function(a,b){for(var c=a[b++],d=0;d<this._contacts.length;d++)this._contacts[d]&&(this._contacts[d].length=0);for(var d=0;c>d;d++){var e=a[b++],f=a[b++],g=this._colliders[e],h=this._colliders[f];this._contacts[e]||(this._contacts[e]=[]),this._contacts[f]||(this._contacts[f]=[]);for(var i,j,k=a[b++],l=0;k>l;l++){if(g.hasCollisionCallback()){var i=new n;i.thisPoint.set(a[b++],a[b++],a[b++]),i.otherPoint.set(a[b++],a[b++],a[b++]),i.normal.set(a[b++],a[b++],a[b++]),i.otherCollider=h,i.thisCollider=g,this._contacts[e].push(i)}else i=null;if(h.hasCollisionCallback()){var j=new n;i?(j.thisPoint.copy(i.otherPoint),j.otherPoint.copy(i.thisPoint),j.normal.copy(i.normal).negate()):(j.thisPoint.set(a[b++],a[b++],a[b++]),j.otherPoint.set(a[b++],a[b++],a[b++]),j.normal.set(a[b++],a[b++],a[b++])),j.thisCollider=h,j.otherCollider=g,this._contacts[f].push(j)}}for(var d=0;d<this._contacts.length;d++){var m=this._contacts[d];m&&m.length&&this._colliders[d].trigger("collision",m)}}return b},_syncInertiaTensor:function(a,b){for(var c=a[b++],d=0;c>d;d++)for(var e=a[b++],f=this._colliders[e],g=f.collisionObject,h=g.invInertiaTensorWorld._array,i=0;9>i;i++)h[i]=a[b++];return b}});return q}),define("qtek/physics/GhostObject",["require","qtek/core/Base"],function(a){var b=a("qtek/core/Base"),c=b.derive({shape:null});return c}),define("qtek/physics/Material",["require","qtek/core/Base"],function(a){var b=a("qtek/core/Base"),c=b.derive({_friction:.5,_bounciness:.3,_dirty:!0});return Object.defineProperty(c.prototype,"friction",{get:function(){return this._friction},set:function(a){this._friction=a,this._dirty=!0}}),Object.defineProperty(c.prototype,"bounciness",{get:function(){return this._bounciness},set:function(a){this._friction=a,this._dirty=!0}}),c}),define("qtek/physics/Physics",["require","qtek/core/Base"],function(a){var b=a("qtek/core/Base"),c=b.derive({engine:null},{});return c}),define("qtek/math/Quaternion",["require","glmatrix"],function(b){var c=b("glmatrix"),d=c.quat,e=function(a,b,c,e){a=a||0,b=b||0,c=c||0,e=void 0===e?1:e,this._array=d.fromValues(a,b,c,e),this._dirty=!0};return e.prototype={constructor:e,get x(){return this._array[0]},set x(a){this._array[0]=a,this._dirty=!0},get y(){this._array[1]=value,this._dirty=!0},set y(a){return this._array[1]},get z(){return this._array[2]},set z(a){this._array[2]=a,this._dirty=!0},get w(){return this._array[3]},set w(a){this._array[3]=a,this._dirty=!0},add:function(a){return d.add(this._array,this._array,a._array),this._dirty=!0,this},calculateW:function(){return d.calculateW(this._array,this._array),this._dirty=!0,this},set:function(a,b,c,d){return this._array[0]=a,this._array[1]=b,this._array[2]=c,this._array[3]=d,this._dirty=!0,this},setArray:function(a){return this._array[0]=a[0],this._array[1]=a[1],this._array[2]=a[2],this._array[3]=a[3],this._dirty=!0,this},clone:function(){return new e(this.x,this.y,this.z,this.w)},conjugate:function(){return d.conjugate(this._array,this._array),this._dirty=!0,this},copy:function(a){return d.copy(this._array,a._array),this._dirty=!0,this},dot:function(a){return d.dot(this._array,a._array)},fromMat3:function(a){return d.fromMat3(this._array,a._array),this._dirty=!0,this},fromMat4:function(){var a=c.mat3,b=a.create();return function(c){return a.fromMat4(b,c._array),a.transpose(b,b),d.fromMat3(this._array,b),this._dirty=!0,this}}(),identity:function(){return d.identity(this._array),this._dirty=!0,this},invert:function(){return d.invert(this._array,this._array),this._dirty=!0,this},len:function(){return d.len(this._array)},length:function(){return d.length(this._array)},lerp:function(a,b,c){return d.lerp(this._array,a._array,b._array,c),this._dirty=!0,this},mul:function(a){return d.mul(this._array,this._array,a._array),this._dirty=!0,this},mulLeft:function(){return d.multiply(this._array,a._array,this._array),this._dirty=!0,this},multiply:function(a){return d.multiply(this._array,this._array,a._array),this._dirty=!0,this},multiplyLeft:function(a){return d.multiply(this._array,a._array,this._array),this._dirty=!0,this},normalize:function(){return d.normalize(this._array,this._array),this._dirty=!0,this},rotateX:function(a){return d.rotateX(this._array,this._array,a),this._dirty=!0,this},rotateY:function(a){return d.rotateY(this._array,this._array,a),this._dirty=!0,this},rotateZ:function(a){return d.rotateZ(this._array,this._array,a),this._dirty=!0,this},rotationTo:function(a,b){return d.rotationTo(this._array,a._array,b._array),this._dirty=!0,this},setAxisAngle:function(a,b){return d.setAxisAngle(this._array,a._array,b),this._dirty=!0,this},slerp:function(a,b,c){return d.slerp(this._array,a._array,b._array,c),this._dirty=!0,this},sqrLen:function(){return d.sqrLen(this._array)},squaredLength:function(){return d.squaredLength(this._array)},setFromEuler:function(){},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"}},e}),define("qtek/math/Matrix3",["require","glmatrix"],function(a){var b=a("glmatrix"),c=b.mat3,d=function(){this._array=c.create()};return d.prototype={constructor:d,adjoint:function(){return c.adjoint(this._array,this._array),this},clone:function(){return(new d).copy(this)},copy:function(a){return c.copy(this._array,a._array),this},determinant:function(){return c.determinant(this._array)},fromMat2d:function(a){return c.fromMat2d(this._array,a._array)},fromMat4:function(a){return c.fromMat4(this._array,a._array)},fromQuat:function(a){return c.fromQuat(this._array,a._array),this},identity:function(){return c.identity(this._array),this},invert:function(){return c.invert(this._array,this._array),this},mul:function(a){return c.mul(this._array,this._array,a._array),this},mulLeft:function(a){return c.mul(this._array,a._array,this._array),this},multiply:function(a){return c.multiply(this._array,this._array,a._array),this},multiplyLeft:function(a){return c.multiply(this._array,a._array,this._array),this},normalFromMat4:function(a){return c.normalFromMat4(this._array,a._array),this},transpose:function(){return c.transpose(this._array,this._array),this},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"}},d}),define("qtek/physics/RigidBody",["require","qtek/core/Base","qtek/math/Vector3","qtek/math/Quaternion","glmatrix","qtek/math/Matrix3"],function(a){var b=a("qtek/core/Base"),c=a("qtek/math/Vector3"),d=(a("qtek/math/Quaternion"),a("glmatrix")),e=d.vec3,f=a("qtek/math/Matrix3"),g=b.derive(function(){return{shape:null,linearVelocity:new c,angularVelocity:new c,localInertia:null,centerOfMass:null,linearFactor:new c(1,1,1),angularFactor:new c(1,1,1),totalForce:new c(0,0,0),totalTorque:new c(0,0,0),massAndDamping:new c,invInertiaTensorWorld:new f}},{applyForce:function(){var a=new c,b=new c;return function(c,d){e.mul(b._array,c._array,this.linearFactor._array),this.totalForce.add(b),d&&(e.cross(a._array,d._array,b._array),this.applyTorque(a))}}(),applyTorque:function(){var a=new c;return function(b){e.mul(a._array,b._array,this.angularFactor._array),this.totalTorque.add(a)}}(),applyImpulse:function(){var a=new c,b=new c;return function(c,d){0!==this.mass&&(e.mul(b._array,c._array,this.linearFactor._array),this.linearVelocity.scaleAndAdd(b,1/this.mass),d&&(e.cross(a._array,d._array,b._array),this.applyTorqueImpulse(a)))}}(),applyTorqueImpulse:function(){var a=new c;return function(b){e.mul(a._array,b._array,this.angularFactor._array),e.transformMat3(this.angularVelocity._array,a._array,this.invInertiaTensorWorld._array),this.angularVelocity._dirty=!0}}(),clearForces:function(){this.totalForce.set(0,0,0),this.totalTorque.set(0,0,0)}});return Object.defineProperty(g.prototype,"mass",{get:function(){return this.massAndDamping._array[0]},set:function(a){this.massAndDamping._array[0]=a,this.massAndDamping._dirty=!0}}),Object.defineProperty(g.prototype,"linearDamping",{get:function(){return this.massAndDamping._array[1]},set:function(a){this.massAndDamping._array[1]=a,this.massAndDamping._dirty=!0}}),Object.defineProperty(g.prototype,"angularDamping",{get:function(){return this.massAndDamping._array[2]},set:function(a){this.massAndDamping._array[2]=a,this.massAndDamping._dirty=!0}}),g});